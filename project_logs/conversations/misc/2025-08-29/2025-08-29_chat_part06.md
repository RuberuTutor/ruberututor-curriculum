To https://github.com/RuberuTutor/ruberututor-curriculum.git
   a5f0020..a51e871  main -> main
iMac:ruberututor_knowledge_pack studio$ tools/check_variants.sh
tools/check_variants.sh: line 14: declare: -A: invalid option
declare: usage: declare [-afFirtx] [-p] [name[=value] ...]
iMac:ruberututor_knowledge_pack studio$ ls -lt project_logs/reports
total 8
-rw-r--r--  1 studio  staff  48 Aug 28 23:22 variants_report_2025-08-28.txt
iMac:ruberututor_knowledge_pack studio$ tail -n 40 "$(ls -t project_logs/reports/variants_report_*.txt | head -n1)"
Variant audit — Thu 28 Aug 2025 23:22:07 EDT

iMac:ruberututor_knowledge_pack studio$ 
ChatGPT said:
Good progress ✅ — the script ran but failed because macOS default /bin/sh was used instead of Bash 4+, and declare -A (associative arrays) isn’t supported there.

Let’s fix it by forcing bash explicitly.

Step 4 — Patch the script
Paste this:

cd ~/Dropbox/ruberututor_knowledge_pack

# Rewrite the script to call bash explicitly
cat > tools/check_variants.sh <<'SH'
#!/usr/bin/env bash
# Variant checker (requires bash 4+)
set -euo pipefail

ROOT="materials"
OUT="project_logs/reports/variants_report_$(date +%F).txt"
mkdir -p "$(dirname "$OUT")"

echo "Variant audit — $(date)" > "$OUT"
echo "" >> "$OUT"

shopt -s nullglob
declare -A SEEN
declare -A HAVE

while IFS= read -r -d '' f; do
  base="$(basename "$f")"
  dir="$(dirname "$f")"
  if [[ "$base" =~ ^(.+)_v([A-D])\.pdf$ ]]; then
    stem="${BASH_REMATCH[1]}"
    var="${BASH_REMATCH[2]}"
    key="$dir/$stem"
    SEEN["$key"]=1
    HAVE["$key:$var"]=1
  fi
done < <(find "$ROOT" -type f -name "*.pdf" -print0)

missing_total=0
for key in "${!SEEN[@]}"; do
  miss=()
  for v in A B C D; do
    [[ -n "${HAVE["$key:$v"]+x}" ]] || miss+=("$v")
  done
  if ((${#miss[@]})); then
    ((missing_total+=${#miss[@]}))
    echo "$key  →  missing variants: ${miss[*]}" >> "$OUT"
  fi
done

if ((missing_total==0)); then
  echo "All worksheet/assessment PDFs have complete variants (vA–vD)." >> "$OUT"
fi

echo "" >> "$OUT"
echo "Report saved to: $OUT"
SH

chmod +x tools/check_variants.sh
git add tools/check_variants.sh
git commit -m "Fix: force bash for variant checker"
git push
Step 5 — Run the checker
After patching, run:

bash tools/check_variants.sh
tail -n 40 "$(ls -t project_logs/reports/variants_report_*.txt | head -n1)"
This will generate a clean report showing which worksheets/assessments are missing vA–vD.

You said:
iMac:ruberututor_knowledge_pack studio$ cd ~/Dropbox/ruberututor_knowledge_pack
iMac:ruberututor_knowledge_pack studio$ 
iMac:ruberututor_knowledge_pack studio$ # Rewrite the script to call bash explicitly
iMac:ruberututor_knowledge_pack studio$ cat > tools/check_variants.sh <<'SH'
> #!/usr/bin/env bash
> # Variant checker (requires bash 4+)
> set -euo pipefail
> 
> ROOT="materials"
> OUT="project_logs/reports/variants_report_$(date +%F).txt"
> mkdir -p "$(dirname "$OUT")"
> 
> echo "Variant audit — $(date)" > "$OUT"
> echo "" >> "$OUT"
> 
> shopt -s nullglob
> declare -A SEEN
> declare -A HAVE
> 
> while IFS= read -r -d '' f; do
>   base="$(basename "$f")"
>   dir="$(dirname "$f")"
>   if [[ "$base" =~ ^(.+)_v([A-D])\.pdf$ ]]; then
>     stem="${BASH_REMATCH[1]}"
>     var="${BASH_REMATCH[2]}"
>     key="$dir/$stem"
>     SEEN["$key"]=1
>     HAVE["$key:$var"]=1
>   fi
> done < <(find "$ROOT" -type f -name "*.pdf" -print0)
> 
> missing_total=0
> for key in "${!SEEN[@]}"; do
>   miss=()
>   for v in A B C D; do
>     [[ -n "${HAVE["$key:$v"]+x}" ]] || miss+=("$v")
>   done
>   if ((${#miss[@]})); then
>     ((missing_total+=${#miss[@]}))
>     echo "$key  →  missing variants: ${miss[*]}" >> "$OUT"
>   fi
> done
> 
> if ((missing_total==0)); then
>   echo "All worksheet/assessment PDFs have complete variants (vA–vD)." >> "$OUT"
> fi
> 
> echo "" >> "$OUT"
> echo "Report saved to: $OUT"
> SH
iMac:ruberututor_knowledge_pack studio$ 
iMac:ruberututor_knowledge_pack studio$ chmod +x tools/check_variants.sh
iMac:ruberututor_knowledge_pack studio$ git add tools/check_variants.sh
iMac:ruberututor_knowledge_pack studio$ git commit -m "Fix: force bash for variant checker"
[main 729728a] Fix: force bash for variant checker
 Committer: Michael Ruberu <studio@imac.home>
Your name and email address were configured automatically based
on your username and hostname. Please check that they are accurate.
You can suppress this message by setting them explicitly. Run the
following command and follow the instructions in your editor to edit
your configuration file:

    git config --global --edit

After doing this, you may fix the identity used for this commit with:

    git commit --amend --reset-author

 1 file changed, 2 insertions(+), 5 deletions(-)
iMac:ruberututor_knowledge_pack studio$ git push
Enumerating objects: 7, done.
Counting objects: 100% (7/7), done.
Delta compression using up to 6 threads
Compressing objects: 100% (4/4), done.
Writing objects: 100% (4/4), 470 bytes | 470.00 KiB/s, done.
Total 4 (delta 2), reused 0 (delta 0), pack-reused 0
remote: Resolving deltas: 100% (2/2), completed with 2 local objects.
To https://github.com/RuberuTutor/ruberututor-curriculum.git
   a51e871..729728a  main -> main
iMac:ruberututor_knowledge_pack studio$ 
ChatGPT said:
bash tools/check_variants.sh
tail -n 80 "$(ls -t project_logs/reports/variants_report_*.txt | head -n1)"
You said:
iMac:ruberututor_knowledge_pack studio$ bash tools/check_variants.sh
tools/check_variants.sh: line 13: declare: -A: invalid option
declare: usage: declare [-afFirtx] [-p] [name[=value] ...]
iMac:ruberututor_knowledge_pack studio$ tail -n 80 "$(ls -t project_logs/reports/variants_report_*.txt | head -n1)"
Variant audit — Thu 28 Aug 2025 23:23:48 EDT

iMac:ruberututor_knowledge_pack studio$ 
ChatGPT said:

Thought for 14s
cd ~/Dropbox/ruberututor_knowledge_pack

cat > tools/check_variants.sh <<'SH'
#!/bin/bash
set -euo pipefail

ROOT="materials"
OUT="project_logs/reports/variants_report_$(date +%F).txt"
mkdir -p "$(dirname "$OUT")"

{
  echo "Variant audit — $(date)"
  echo ""
  find "$ROOT" -type f -name "*_v[A-D].pdf" | awk -v SUBSEP="\034" '
  {
    file=$0
    stem=file
    sub(/_v[A-D]\.pdf$/, "", stem)
    seen[stem]=1
    if (file ~ /_vA\.pdf$/) have[stem,SUBSEP "A"]=1
    if (file ~ /_vB\.pdf$/) have[stem,SUBSEP "B"]=1
    if (file ~ /_vC\.pdf$/) have[stem,SUBSEP "C"]=1
    if (file ~ /_vD\.pdf$/) have[stem,SUBSEP "D"]=1
  }
  END{
    missing_total=0
    for (s in seen){
      miss=""
      if (!(s SUBSEP "A" in have)) miss=miss "A "
      if (!(s SUBSEP "B" in have)) miss=miss "B "
      if (!(s SUBSEP "C" in have)) miss=miss "C "
      if (!(s SUBSEP "D" in have)) miss=miss "D "
      if (length(miss)>0){
        sub(/[ ]+$/, "", miss)
        printf "%s  →  missing variants: %s\n", s, miss
        missing_total++
      }
    }
    if (missing_total==0){
      print "All worksheet/assessment PDFs have complete variants (vA–vD)."
    }
  }'
  echo ""
  echo "Report saved to: $OUT"
} >"$OUT"

echo "Report saved to: $OUT"
SH

chmod +x tools/check_variants.sh
git add tools/check_variants.sh
git commit -m "Compat: rewrite variant checker without bash 4 associative arrays"
git push
bash tools/check_variants.sh
tail -n 80 "$(ls -t project_logs/reports/variants_report_*.txt | head -n1)"
You said:
iMac:ruberututor_knowledge_pack studio$ cd ~/Dropbox/ruberututor_knowledge_pack
iMac:ruberututor_knowledge_pack studio$ 
iMac:ruberututor_knowledge_pack studio$ cat > tools/check_variants.sh <<'SH'
> #!/bin/bash
> set -euo pipefail
> 
> ROOT="materials"
> OUT="project_logs/reports/variants_report_$(date +%F).txt"
> mkdir -p "$(dirname "$OUT")"
> 
> {
>   echo "Variant audit — $(date)"
>   echo ""
>   find "$ROOT" -type f -name "*_v[A-D].pdf" | awk -v SUBSEP="\034" '
>   {
>     file=$0
>     stem=file
>     sub(/_v[A-D]\.pdf$/, "", stem)
>     seen[stem]=1
>     if (file ~ /_vA\.pdf$/) have[stem,SUBSEP "A"]=1
>     if (file ~ /_vB\.pdf$/) have[stem,SUBSEP "B"]=1
>     if (file ~ /_vC\.pdf$/) have[stem,SUBSEP "C"]=1
>     if (file ~ /_vD\.pdf$/) have[stem,SUBSEP "D"]=1
>   }
>   END{
>     missing_total=0
>     for (s in seen){
>       miss=""
>       if (!(s SUBSEP "A" in have)) miss=miss "A "
>       if (!(s SUBSEP "B" in have)) miss=miss "B "
>       if (!(s SUBSEP "C" in have)) miss=miss "C "
>       if (!(s SUBSEP "D" in have)) miss=miss "D "
>       if (length(miss)>0){
>         sub(/[ ]+$/, "", miss)
>         printf "%s  →  missing variants: %s\n", s, miss
>         missing_total++
>       }
>     }
>     if (missing_total==0){
>       print "All worksheet/assessment PDFs have complete variants (vA–vD)."
>     }
>   }'
>   echo ""
>   echo "Report saved to: $OUT"
> } >"$OUT"
> 
> echo "Report saved to: $OUT"
> SH
iMac:ruberututor_knowledge_pack studio$ 
iMac:ruberututor_knowledge_pack studio$ chmod +x tools/check_variants.sh
iMac:ruberututor_knowledge_pack studio$ git add tools/check_variants.sh
iMac:ruberututor_knowledge_pack studio$ git commit -m "Compat: rewrite variant checker without bash 4 associative arrays"
[main 23a15db] Compat: rewrite variant checker without bash 4 associative arrays
 Committer: Michael Ruberu <studio@imac.home>
Your name and email address were configured automatically based
on your username and hostname. Please check that they are accurate.
You can suppress this message by setting them explicitly. Run the
following command and follow the instructions in your editor to edit
your configuration file:

    git config --global --edit

After doing this, you may fix the identity used for this commit with:

    git commit --amend --reset-author

 1 file changed, 36 insertions(+), 37 deletions(-)
iMac:ruberututor_knowledge_pack studio$ git push
Enumerating objects: 7, done.
Counting objects: 100% (7/7), done.
Delta compression using up to 6 threads
Compressing objects: 100% (4/4), done.
Writing objects: 100% (4/4), 912 bytes | 912.00 KiB/s, done.
Total 4 (delta 1), reused 0 (delta 0), pack-reused 0
remote: Resolving deltas: 100% (1/1), completed with 1 local object.
To https://github.com/RuberuTutor/ruberututor-curriculum.git
   729728a..23a15db  main -> main
iMac:ruberututor_knowledge_pack studio$ bash tools/check_variants.sh
find: materials: No such file or directory
iMac:ruberututor_knowledge_pack studio$ tail -n 80 "$(ls -t project_logs/reports/variants_report_*.txt | head -n1)"
Variant audit — Thu 28 Aug 2025 23:26:04 EDT

All worksheet/assessment PDFs have complete variants (vA–vD).
iMac:ruberututor_knowledge_pack studio$ 
ChatGPT said:

Thought for 8s
# Step 6 — Create the materials tree (worksheets + assessments)
cd ~/Dropbox/ruberututor_knowledge_pack
mkdir -p materials/worksheets/{math,english}/gr{1..12}
mkdir -p materials/assessments/{math,english}/gr{1..12}
find materials -type d -exec touch {}/.gitkeep \;
git add materials
git commit -m "Scaffold materials tree for worksheets and assessments"
git push
# Step 7 — Replace save_pdf.sh to copy batches and verify vA–vD per stem
cd ~/Dropbox/ruberututor_knowledge_pack

cp -n tools/save_pdf.sh tools/save_pdf.sh.bak 2>/dev/null || true

cat > tools/save_pdf.sh <<'SH'
#!/bin/bash
# Usage:
#   bash tools/save_pdf.sh <worksheets|assessments> <math|english> <gr1..gr12> <StrandOrGroup> <pdf1> [pdf2 ...]
# Example:
#   bash tools/save_pdf.sh worksheets math gr1 B_Number ~/Downloads/*.pdf
set -euo pipefail

usage(){ echo "Usage: bash tools/save_pdf.sh <worksheets|assessments> <math|english> <gr1..gr12> <StrandOrGroup> <pdf1> [pdf2 ...]"; exit 1; }
[[ $# -ge 5 ]] || usage

TYPE="$1"; SUBJECT="$2"; GRADE="$3"; STRAND="$4"; shift 4
case "$TYPE" in worksheets|assessments) ;; *) echo "❌ TYPE must be worksheets|assessments"; exit 1;; esac
case "$SUBJECT" in math|english) ;; *) echo "❌ SUBJECT must be math|english"; exit 1;; esac
case "$GRADE" in gr[1-9]|gr1[0-2]) ;; *) echo "❌ GRADE must be gr1..gr12"; exit 1;; esac

REPO="$HOME/Dropbox/ruberututor_knowledge_pack"
DEST="$REPO/materials/$TYPE/$SUBJECT/$GRADE/$STRAND"
mkdir -p "$DEST"

added=0; skipped=0
for PDF in "$@"; do
  if [[ ! -f "$PDF" ]]; then echo "⚠️  Missing file: $PDF"; ((skipped++)); continue; fi
  base="$(basename "$PDF")"
  if [[ -f "$DEST/$base" ]]; then echo "↩️  Exists, skipping: $base"; ((skipped++)); continue; fi
  cp "$PDF" "$DEST/$base"
  echo "✅ Added: $base"
  ((added++))
done

cd "$REPO"
if (( added > 0 )); then
  git add "$DEST"
  git commit -m "Add $TYPE $SUBJECT $GRADE $STRAND: $added file(s)"
  git push
fi

# Variant audit (ensure vA–vD present for each stem in DEST)
report="$REPO/project_logs/reports/variant_postsave_$(date +%F_%H%M%S).txt"
mkdir -p "$(dirname "$report")"
{
  echo "Post-save variant check — $(date)"
  echo "$DEST"
  find "$DEST" -type f -name "*_v[A-D].pdf" | awk -v SUBSEP="\034" '
  {
    f=$0; stem=f; sub(/_v[A-D]\.pdf$/, "", stem);
    seen[stem]=1;
    if (f ~ /_vA\.pdf$/) have[stem,SUBSEP "A"]=1;
    if (f ~ /_vB\.pdf$/) have[stem,SUBSEP "B"]=1;
    if (f ~ /_vC\.pdf$/) have[stem,SUBSEP "C"]=1;
    if (f ~ /_vD\.pdf$/) have[stem,SUBSEP "D"]=1;
  }
  END{
    missing_any=0;
    for (s in seen){
      miss="";
      if (!(s SUBSEP "A" in have)) miss=miss "A ";
      if (!(s SUBSEP "B" in have)) miss=miss "B ";
      if (!(s SUBSEP "C" in have)) miss=miss "C ";
      if (!(s SUBSEP "D" in have)) miss=miss "D ";
      if (length(miss)>0){
        sub(/[ ]+$/, "", miss);
        printf "%s  →  missing: %s\n", s, miss;
        missing_any=1;
      }
    }
    if (!missing_any) print "All stems in this folder have vA–vD.";
