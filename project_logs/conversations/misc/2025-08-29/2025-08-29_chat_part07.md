  }'
} > "$report"
echo "üìÑ Report: $report"
SH

chmod +x tools/save_pdf.sh
git add tools/save_pdf.sh
git commit -m "Update save_pdf.sh: batch copy + post-save vA‚ÄìvD audit"
git push
# Step 8 ‚Äî Run a quick repository-wide variant audit
cd ~/Dropbox/ruberututor_knowledge_pack
bash tools/check_variants.sh
tail -n 200 "$(ls -t project_logs/reports/variants_report_*.txt | head -n1)"
You said:
iMac:ruberututor_knowledge_pack studio$ # Step 6 ‚Äî Create the materials tree (worksheets + assessments)
iMac:ruberututor_knowledge_pack studio$ cd ~/Dropbox/ruberututor_knowledge_pack
iMac:ruberututor_knowledge_pack studio$ mkdir -p materials/worksheets/{math,english}/gr{1..12}
iMac:ruberututor_knowledge_pack studio$ mkdir -p materials/assessments/{math,english}/gr{1..12}
iMac:ruberututor_knowledge_pack studio$ find materials -type d -exec touch {}/.gitkeep \;
iMac:ruberututor_knowledge_pack studio$ git add materials
iMac:ruberututor_knowledge_pack studio$ git commit -m "Scaffold materials tree for worksheets and assessments"
[main aa8a929] Scaffold materials tree for worksheets and assessments
 Committer: Michael Ruberu <studio@imac.home>
Your name and email address were configured automatically based
on your username and hostname. Please check that they are accurate.
You can suppress this message by setting them explicitly. Run the
following command and follow the instructions in your editor to edit
your configuration file:

    git config --global --edit

After doing this, you may fix the identity used for this commit with:

    git commit --amend --reset-author

 55 files changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 materials/.gitkeep
 create mode 100644 materials/assessments/.gitkeep
 create mode 100644 materials/assessments/english/.gitkeep
 create mode 100644 materials/assessments/english/gr1/.gitkeep
 create mode 100644 materials/assessments/english/gr10/.gitkeep
 create mode 100644 materials/assessments/english/gr11/.gitkeep
 create mode 100644 materials/assessments/english/gr12/.gitkeep
 create mode 100644 materials/assessments/english/gr2/.gitkeep
 create mode 100644 materials/assessments/english/gr3/.gitkeep
 create mode 100644 materials/assessments/english/gr4/.gitkeep
 create mode 100644 materials/assessments/english/gr5/.gitkeep
 create mode 100644 materials/assessments/english/gr6/.gitkeep
 create mode 100644 materials/assessments/english/gr7/.gitkeep
 create mode 100644 materials/assessments/english/gr8/.gitkeep
 create mode 100644 materials/assessments/english/gr9/.gitkeep
 create mode 100644 materials/assessments/math/.gitkeep
 create mode 100644 materials/assessments/math/gr1/.gitkeep
 create mode 100644 materials/assessments/math/gr10/.gitkeep
 create mode 100644 materials/assessments/math/gr11/.gitkeep
 create mode 100644 materials/assessments/math/gr12/.gitkeep
 create mode 100644 materials/assessments/math/gr2/.gitkeep
 create mode 100644 materials/assessments/math/gr3/.gitkeep
 create mode 100644 materials/assessments/math/gr4/.gitkeep
 create mode 100644 materials/assessments/math/gr5/.gitkeep
 create mode 100644 materials/assessments/math/gr6/.gitkeep
 create mode 100644 materials/assessments/math/gr7/.gitkeep
 create mode 100644 materials/assessments/math/gr8/.gitkeep
 create mode 100644 materials/assessments/math/gr9/.gitkeep
 create mode 100644 materials/worksheets/.gitkeep
 create mode 100644 materials/worksheets/english/.gitkeep
 create mode 100644 materials/worksheets/english/gr1/.gitkeep
 create mode 100644 materials/worksheets/english/gr10/.gitkeep
 create mode 100644 materials/worksheets/english/gr11/.gitkeep
 create mode 100644 materials/worksheets/english/gr12/.gitkeep
 create mode 100644 materials/worksheets/english/gr2/.gitkeep
 create mode 100644 materials/worksheets/english/gr3/.gitkeep
 create mode 100644 materials/worksheets/english/gr4/.gitkeep
 create mode 100644 materials/worksheets/english/gr5/.gitkeep
 create mode 100644 materials/worksheets/english/gr6/.gitkeep
 create mode 100644 materials/worksheets/english/gr7/.gitkeep
 create mode 100644 materials/worksheets/english/gr8/.gitkeep
 create mode 100644 materials/worksheets/english/gr9/.gitkeep
 create mode 100644 materials/worksheets/math/.gitkeep
 create mode 100644 materials/worksheets/math/gr1/.gitkeep
 create mode 100644 materials/worksheets/math/gr10/.gitkeep
 create mode 100644 materials/worksheets/math/gr11/.gitkeep
 create mode 100644 materials/worksheets/math/gr12/.gitkeep
 create mode 100644 materials/worksheets/math/gr2/.gitkeep
 create mode 100644 materials/worksheets/math/gr3/.gitkeep
 create mode 100644 materials/worksheets/math/gr4/.gitkeep
 create mode 100644 materials/worksheets/math/gr5/.gitkeep
 create mode 100644 materials/worksheets/math/gr6/.gitkeep
 create mode 100644 materials/worksheets/math/gr7/.gitkeep
 create mode 100644 materials/worksheets/math/gr8/.gitkeep
 create mode 100644 materials/worksheets/math/gr9/.gitkeep
iMac:ruberututor_knowledge_pack studio$ git push
Enumerating objects: 8, done.
Counting objects: 100% (8/8), done.
Delta compression using up to 6 threads
Compressing objects: 100% (5/5), done.
Writing objects: 100% (7/7), 641 bytes | 641.00 KiB/s, done.
Total 7 (delta 1), reused 0 (delta 0), pack-reused 0
remote: Resolving deltas: 100% (1/1), completed with 1 local object.
To https://github.com/RuberuTutor/ruberututor-curriculum.git
   23a15db..aa8a929  main -> main
iMac:ruberututor_knowledge_pack studio$ # Step 7 ‚Äî Replace save_pdf.sh to copy batches and verify vA‚ÄìvD per stem
iMac:ruberututor_knowledge_pack studio$ cd ~/Dropbox/ruberututor_knowledge_pack
iMac:ruberututor_knowledge_pack studio$ 
iMac:ruberututor_knowledge_pack studio$ cp -n tools/save_pdf.sh tools/save_pdf.sh.bak 2>/dev/null || true
iMac:ruberututor_knowledge_pack studio$ 
iMac:ruberututor_knowledge_pack studio$ cat > tools/save_pdf.sh <<'SH'
> #!/bin/bash
> # Usage:
> #   bash tools/save_pdf.sh <worksheets|assessments> <math|english> <gr1..gr12> <StrandOrGroup> <pdf1> [pdf2 ...]
> # Example:
> #   bash tools/save_pdf.sh worksheets math gr1 B_Number ~/Downloads/*.pdf
> set -euo pipefail
> 
> usage(){ echo "Usage: bash tools/save_pdf.sh <worksheets|assessments> <math|english> <gr1..gr12> <StrandOrGroup> <pdf1> [pdf2 ...]"; exit 1; }
> [[ $# -ge 5 ]] || usage
> 
> TYPE="$1"; SUBJECT="$2"; GRADE="$3"; STRAND="$4"; shift 4
> case "$TYPE" in worksheets|assessments) ;; *) echo "‚ùå TYPE must be worksheets|assessments"; exit 1;; esac
> case "$SUBJECT" in math|english) ;; *) echo "‚ùå SUBJECT must be math|english"; exit 1;; esac
> case "$GRADE" in gr[1-9]|gr1[0-2]) ;; *) echo "‚ùå GRADE must be gr1..gr12"; exit 1;; esac
> 
> REPO="$HOME/Dropbox/ruberututor_knowledge_pack"
> DEST="$REPO/materials/$TYPE/$SUBJECT/$GRADE/$STRAND"
> mkdir -p "$DEST"
> 
> added=0; skipped=0
> for PDF in "$@"; do
>   if [[ ! -f "$PDF" ]]; then echo "‚ö†Ô∏è  Missing file: $PDF"; ((skipped++)); continue; fi
>   base="$(basename "$PDF")"
>   if [[ -f "$DEST/$base" ]]; then echo "‚Ü©Ô∏è  Exists, skipping: $base"; ((skipped++)); continue; fi
>   cp "$PDF" "$DEST/$base"
>   echo "‚úÖ Added: $base"
>   ((added++))
> done
> 
> cd "$REPO"
> if (( added > 0 )); then
>   git add "$DEST"
>   git commit -m "Add $TYPE $SUBJECT $GRADE $STRAND: $added file(s)"
>   git push
> fi
> 
> # Variant audit (ensure vA‚ÄìvD present for each stem in DEST)
> report="$REPO/project_logs/reports/variant_postsave_$(date +%F_%H%M%S).txt"
> mkdir -p "$(dirname "$report")"
> {
>   echo "Post-save variant check ‚Äî $(date)"
>   echo "$DEST"
>   find "$DEST" -type f -name "*_v[A-D].pdf" | awk -v SUBSEP="\034" '
>   {
>     f=$0; stem=f; sub(/_v[A-D]\.pdf$/, "", stem);
>     seen[stem]=1;
>     if (f ~ /_vA\.pdf$/) have[stem,SUBSEP "A"]=1;
>     if (f ~ /_vB\.pdf$/) have[stem,SUBSEP "B"]=1;
>     if (f ~ /_vC\.pdf$/) have[stem,SUBSEP "C"]=1;
>     if (f ~ /_vD\.pdf$/) have[stem,SUBSEP "D"]=1;
>   }
>   END{
>     missing_any=0;
>     for (s in seen){
>       miss="";
>       if (!(s SUBSEP "A" in have)) miss=miss "A ";
>       if (!(s SUBSEP "B" in have)) miss=miss "B ";
>       if (!(s SUBSEP "C" in have)) miss=miss "C ";
>       if (!(s SUBSEP "D" in have)) miss=miss "D ";
>       if (length(miss)>0){
>         sub(/[ ]+$/, "", miss);
>         printf "%s  ‚Üí  missing: %s\n", s, miss;
>         missing_any=1;
>       }
>     }
>     if (!missing_any) print "All stems in this folder have vA‚ÄìvD.";
>   }'
> } > "$report"
> echo "üìÑ Report: $report"
> SH
iMac:ruberututor_knowledge_pack studio$ 
iMac:ruberututor_knowledge_pack studio$ chmod +x tools/save_pdf.sh
iMac:ruberututor_knowledge_pack studio$ git add tools/save_pdf.sh
iMac:ruberututor_knowledge_pack studio$ git commit -m "Update save_pdf.sh: batch copy + post-save vA‚ÄìvD audit"
[main 65d3e87] Update save_pdf.sh: batch copy + post-save vA‚ÄìvD audit
 Committer: Michael Ruberu <studio@imac.home>
Your name and email address were configured automatically based
on your username and hostname. Please check that they are accurate.
You can suppress this message by setting them explicitly. Run the
following command and follow the instructions in your editor to edit
your configuration file:

    git config --global --edit

After doing this, you may fix the identity used for this commit with:

    git commit --amend --reset-author

 1 file changed, 69 insertions(+)
 create mode 100755 tools/save_pdf.sh
iMac:ruberututor_knowledge_pack studio$ git push
Enumerating objects: 6, done.
Counting objects: 100% (6/6), done.
Delta compression using up to 6 threads
Compressing objects: 100% (4/4), done.
Writing objects: 100% (4/4), 1.45 KiB | 1.45 MiB/s, done.
Total 4 (delta 2), reused 0 (delta 0), pack-reused 0
remote: Resolving deltas: 100% (2/2), completed with 2 local objects.
To https://github.com/RuberuTutor/ruberututor-curriculum.git
   aa8a929..65d3e87  main -> main
iMac:ruberututor_knowledge_pack studio$ # Step 8 ‚Äî Run a quick repository-wide variant audit
iMac:ruberututor_knowledge_pack studio$ cd ~/Dropbox/ruberututor_knowledge_pack
iMac:ruberututor_knowledge_pack studio$ bash tools/check_variants.sh
Report saved to: project_logs/reports/variants_report_2025-08-28.txt
iMac:ruberututor_knowledge_pack studio$ tail -n 200 "$(ls -t project_logs/reports/variants_report_*.txt | head -n1)"
Variant audit ‚Äî Thu 28 Aug 2025 23:29:39 EDT

All worksheet/assessment PDFs have complete variants (vA‚ÄìvD).

Report saved to: project_logs/reports/variants_report_2025-08-28.txt
iMac:ruberututor_knowledge_pack studio$ 
iMac:ruberututor_knowledge_pack studio$ 
ChatGPT said:
‚úÖ Perfect ‚Äî you now have:

Materials tree (worksheets + assessments, gr1‚Äìgr12, math + english).

Variant checker (tools/check_variants.sh) ‚Üí generates a report and confirms whether each skill has all vA‚ÄìvD.

Upgraded PDF saver (tools/save_pdf.sh) ‚Üí batch-copies PDFs into the right folder, commits, pushes, and runs a post-save vA‚ÄìvD audit.

Reports are stored in project_logs/reports/ for tracking.

At this moment your system is ready to:

Drop in any worksheet or assessment (A‚ÄìD variants).

Automatically store, version, and audit them.

Confirm across the repo that no variant is missing.

üëâ Next step for you:
Would you like me to now extend the PDF saver to also auto-route by Ontario code (e.g., Gr1_Math_B_Number_B1-1_‚Ä¶ ‚Üí into materials/worksheets/math/gr1/B_Number/), so you don‚Äôt even have to type grade/strand in the command? That would make saving new worksheets almost one-command.

You said:
yes
ChatGPT said:

Thought for 16s
cd ~/Dropbox/ruberututor_knowledge_pack

cat > tools/auto_route_pdfs.sh <<'SH'
#!/bin/bash
# Auto-route PDFs by Ontario-coded filename into materials tree.
# Usage:
#   bash tools/auto_route_pdfs.sh <worksheets|assessments> <pdf1> [pdf2 ...]
set -euo pipefail

usage(){ echo "Usage: bash tools/auto_route_pdfs.sh <worksheets|assessments> <pdf1> [pdf2 ...]"; exit 1; }
[[ $# -ge 2 ]] || usage

TYPE="$1"; shift
case "$TYPE" in worksheets|assessments) ;; *) echo "‚ùå TYPE must be worksheets|assessments"; exit 1;; esac

REPO="$HOME/Dropbox/ruberututor_knowledge_pack"
BASE="$REPO/materials/$TYPE"
mkdir -p "$BASE"

added=0; skipped=0; failed=0

route_one() {
  local PDF="$1"
  local name base ext
  [[ -f "$PDF" ]] || { echo "‚ö†Ô∏è  Missing file: $PDF"; ((failed++)); return; }
  base="$(basename "$PDF")"

  # Expect forms like:
  # Gr1_Math_B_Number_B1-1_Count_to_50_vA.pdf
  # Gr7_Math_C_Algebra_C2-3_OneStep_Equations_vB.pdf
  # Gr9_English_ReadingLiterature_RL1_Theme_Inference_vC.pdf
  # Gr3_English_B_Foundations_B2-1_Phonics_vD.pdf

  # Split on underscores via awk for flexibility
  eval "$(
    echo "$base" | awk -F'_' '
      function lower(s){ gsub(/[A-Z]/,"&",s); return tolower(s) }
      {
        n=NF
        # Extract grade "GrX"
        grade=$1
        if (match(grade, /^Gr([0-9]{1,2})$/)==0){ print "ok=0"; next }
        gnum=substr(grade,3)
        gfolder="gr" gnum

        subj=$2
        subjl=tolower(subj)

        # Determine strand/group token(s)
        # Case A: Letter + Word (e.g., B_Number) ‚Üí tokens 3 + 4
        # Case B: Single word group (e.g., ReadingLiterature) ‚Üí token 3
        strand=""
        idx_after_strand=0
        if ($3 ~ /^[A-F]$/ && $4 ~ /^[A-Za-z]+$/) {
          strand=$3"_"$4
          idx_after_strand=5
        } else {
          strand=$3
          idx_after_strand=4
        }

        # Skill code token (e.g., B1-1 or RL1); if pattern holds
        skill=$idx_after_strand

        # Variant at end must match _vA.._vD
        variant=$n
        if (match($variant, /^v[A-D]\.pdf$/)==0){
          # Sometimes variant comes as last token with .pdf attached to previous
          # Strip .pdf from last field
          sub(/\.pdf$/,"", $n)
        }

        print "ok=1; gfolder=\""gfolder"\"; subject=\""subjl"\"; strand=\""<<strand<<"\""
      }'
  )"

  if [[ "${ok:-0}" != "1" ]]; then
    echo "‚ùå Unrecognized filename (cannot parse grade/subject/strand): $base"
    ((failed++)); return
  fi

  dest="$BASE/$subject/$gfolder/$strand"
  mkdir -p "$dest"

  if [[ -f "$dest/$base" ]]; then
    echo "‚Ü©Ô∏è  Exists, skipping: $base"
    ((skipped++)); return
  fi

  cp "$PDF" "$dest/$base"
  echo "‚úÖ Added: $dest/$base"
  ((added++))
}

for f in "$@"; do
  route_one "$f"
done

cd "$REPO"
if (( added > 0 )); then
  git add materials
  git commit -m "Auto-route $TYPE PDFs: added $added (skipped=$skipped, failed=$failed)"
  git push
fi

# Post-save quick audit for destination folders touched (ensure vA‚ÄìvD per stem)
report="$REPO/project_logs/reports/auto_route_audit_$(date +%F_%H%M%S).txt"
mkdir -p "$(dirname "$report")"

{
  echo "Auto-route audit ‚Äî $(date)"
  echo "Type: $TYPE"
  echo ""
  find "$BASE" -type f -name "*_v[A-D].pdf" | awk -v SUBSEP="\034" '
  {
    f=$0; stem=f; sub(/_v[A-D]\.pdf$/, "", stem);
    seen[stem]=1;
    if (f ~ /_vA\.pdf$/) have[stem,SUBSEP "A"]=1;
    if (f ~ /_vB\.pdf$/) have[stem,SUBSEP "B"]=1;
    if (f ~ /_vC\.pdf$/) have[stem,SUBSEP "C"]=1;
    if (f ~ /_vD\.pdf$/) have[stem,SUBSEP "D"]=1;
  }
  END{
    any=0;
    for (s in seen){
      miss="";
      if (!(s SUBSEP "A" in have)) miss=miss "A ";
      if (!(s SUBSEP "B" in have)) miss=miss "B ";
      if (!(s SUBSEP "C" in have)) miss=miss "C ";
      if (!(s SUBSEP "D" in have)) miss=miss "D ";
      if (length(miss)>0){
        sub(/[ ]+$/, "", miss);
        printf "%s  ‚Üí  missing variants: %s\n", s, miss;
        any=1;
      }
    }
    if (!any) print "All stems present with vA‚ÄìvD.";
  }'
  echo ""
  echo "Added=$added  Skipped=$skipped  Failed=$failed"
} > "$report"

echo "üìÑ Report: $report"
SH

chmod +x tools/auto_route_pdfs.sh
git add tools/auto_route_pdfs.sh
git commit -m "Add auto_route_pdfs.sh: filename-based Ontario code routing"
git push
bash tools/auto_route_pdfs.sh worksheets ~/Downloads/Gr1_Math_B_Number_B1-1_Count_to_50_vA.pdf ~/Downloads/Gr1_Math_B_Number_B1-1_Count_to_50_vB.pdf ~/Downloads/Gr1_Math_B_Number_B1-1_Count_to_50_vC.pdf ~/Downloads/Gr1_Math_B_Number_B1-1_Count_to_50_vD.pdf
bash tools/auto_route_pdfs.sh assessments ~/Downloads/Gr9_English_ReadingLiterature_RL1_Theme_Inference_vA.pdf ~/Downloads/Gr9_English_ReadingLiterature_RL1_Theme_Inference_vB.pdf ~/Downloads/Gr9_English_ReadingLiterature_RL1_Theme_Inference_vC.pdf ~/Downloads/Gr9_English_ReadingLiterature_RL1_Theme_Inference_vD.pdf
ls -R materials/worksheets/math/gr1/B_Number
ls -R materials/assessments/english/gr9/ReadingLiterature
tail -n 80 "$(ls -t project_logs/reports/auto_route_audit_*.txt | head -n1)"
