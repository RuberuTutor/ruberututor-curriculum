cd ~/Dropbox/ruberututor_knowledge_pack || { echo "âŒ Repo not found"; exit 1; }

D="$(date +%F)"
DIR="project_logs/conversations/misc/$D"
mkdir -p "$DIR"

echo "ðŸ‘‰ Now COPY the entire chat (âŒ˜A, âŒ˜C). Then press ENTER hereâ€¦"
read -r

TMP="$(mktemp)"
pbpaste > "$TMP"

[ -s "$TMP" ] || { echo "âŒ Your clipboard is empty. Copy the chat and run again."; rm -f "$TMP"; exit 1; }

awk -v D="$D" -v DIR="$DIR" -v N=400 '
{ f=sprintf("%s/%s_chat_part%02d.md", DIR, D, int((NR-1)/N)+1); print > f }
' "$TMP"

cp "$TMP" "$DIR/${D}_chat_full.md"
rm -f "$TMP"

git add "$DIR"
git commit -m "backup: chat split into parts for $D"
git push

echo "âœ… Backed up to $DIR"
